var wpLinkPopup;!function(a){var b,c,d={},e={};wpLinkPopup={timeToTriggerRiver:150,minRiverAJAXDuration:200,riverBottomThreshold:5,keySensitivity:100,lastSearch:"",textarea:"",updateCallback:"",currentLink:{href:"",title:"",target:""},init:function(){a(document.body).append(a("#wpLinkChooserDialog").html()),d.dialog=a("#wp-link-chooser"),d.contentType=a("#wp-link-chooser .search-content-type"),d.submit=a("#wp-link-chooser .wp-link-submit"),d.url=a("#wp-link-chooser .url-field"),d.nonce=a("#_ajax_linking_nonce"),d.title=a("#wp-link-chooser .link-title-field"),d.openInNewTab=a("#wp-link-chooser .link-target-checkbox"),d.search=a("#wp-link-chooser .link-search-field"),e.search=new b(a("#wp-link-chooser .search-results")),e.recent=new b(a("#wp-link-chooser .most-recent-results")),e.elements=a("#wp-link-chooser .query-results"),d.dialog.keydown(wpLinkPopup.keydown),d.dialog.keyup(wpLinkPopup.keyup),d.submit.click(function(a){a.preventDefault(),wpLinkPopup.update()}),a("#wp-link-chooser .wp-link-cancel").click(function(a){a.preventDefault(),wpLinkPopup.close()}),a("#wp-link-chooser .internal-toggle").click(wpLinkPopup.toggleInternalLinking),e.elements.bind("river-select",wpLinkPopup.updateFields),d.search.keyup(wpLinkPopup.searchInternalLinks),d.dialog.bind("wpdialogrefresh",wpLinkPopup.refresh),d.dialog.bind("wpdialogbeforeopen",wpLinkPopup.beforeOpen),d.dialog.bind("wpdialogclose",wpLinkPopup.onClose)},beforeOpen:function(){},open:function(a){d.dialog.dialog({autoOpen:!0,title:wpLinkL10nPopup.title,width:480,height:"auto",dialogClass:"wp-dialog",modal:!0}),wpLinkPopup.updateCallback=a},refresh:function(){e.search.refresh(),e.recent.refresh(),wpLinkPopup.setDefaultValues(),e.recent.ul.children().length||e.recent.ajax()},close:function(){a("#wp-link-chooser").dialog("close")},onClose:function(){},getAttrs:function(){return{href:d.url.val(),title:d.title.val(),target:d.openInNewTab.prop("checked")?"_blank":""}},update:function(){wpLinkPopup.htmlUpdate()},htmlUpdate:function(){var a;a=wpLinkPopup.getAttrs(),a.href&&"http://"!==a.href&&(wpLinkPopup.updateCallback(a),wpLinkPopup.close())},updateFields:function(a,b,c){d.url.val(b.children(".item-permalink").val()),d.title.val(b.hasClass("no-title")?"":b.children(".item-title").text()),c&&"click"===c.type&&d.url.focus()},setDefaultValues:function(){d.url.val("http://"),d.title.val(""),d.submit.val(wpLinkL10nPopup.save)},searchInternalLinks:function(){var b,c=a(this),d=c.val();if(d.length>2){if(e.recent.hide(),e.search.show(),wpLinkPopup.lastSearch===d)return;wpLinkPopup.lastSearch=d,b=c.parent().find(".spinner").show(),e.search.change(d),e.search.ajax(function(){b.hide()})}else e.search.hide(),e.recent.show()},next:function(){e.search.next(),e.recent.next()},prev:function(){e.search.prev(),e.recent.prev()},keydown:function(b){var c,d=a.ui.keyCode;(b.which===d.UP||b.which===d.DOWN)&&(c=b.which===d.UP?"prev":"next",clearInterval(wpLinkPopup.keyInterval),wpLinkPopup[c](),wpLinkPopup.keyInterval=setInterval(wpLinkPopup[c],wpLinkPopup.keySensitivity),b.preventDefault())},keyup:function(b){var c=a.ui.keyCode;return b.which===c.ESCAPE?(b.stopImmediatePropagation(),a(document).triggerHandler("wp_CloseOnEscape",[{event:b,what:"wplink",cb:wpLinkPopup.close}])||wpLinkPopup.close(),!1):((b.which===c.UP||b.which===c.DOWN)&&(clearInterval(wpLinkPopup.keyInterval),b.preventDefault()),void 0)},delayedCallback:function(a,b){var c,d,e,f;return b?(setTimeout(function(){return d?a.apply(f,e):(c=!0,void 0)},b),function(){return c?a.apply(this,arguments):(e=arguments,f=this,d=!0,void 0)}):a},toggleInternalLinking:function(b){var c=a("#wp-link-chooser .search-panel"),e=!c.is(":visible");a(this).toggleClass("toggle-arrow-active",e),d.dialog.height("auto"),c.slideToggle(300,function(){setUserSetting("wplink",e?"1":"0"),d[e?"search":"url"].focus()}),b.preventDefault()}},b=function(b,c){var d=this;this.element=b,this.ul=b.children("ul"),this.waiting=b.find(".river-waiting"),this.change(c),this.refresh(),b.scroll(function(){d.maybeLoad()}),b.delegate("li","click",function(b){d.select(a(this),b)})},a.extend(b.prototype,{refresh:function(){this.deselect(),this.visible=this.element.is(":visible")},show:function(){this.visible||(this.deselect(),this.element.show(),this.visible=!0)},hide:function(){this.element.hide(),this.visible=!1},select:function(a,b){var c,d,e,f;a.hasClass("unselectable")||a===this.selected||(this.deselect(),this.selected=a.addClass("selected"),c=a.outerHeight(),d=this.element.height(),e=a.position().top,f=this.element.scrollTop(),0>e?this.element.scrollTop(f+e):e+c>d&&this.element.scrollTop(f+e-d+c),this.element.trigger("river-select",[a,b,this]))},deselect:function(){this.selected&&this.selected.removeClass("selected"),this.selected=!1},prev:function(){if(this.visible){var a;this.selected&&(a=this.selected.prev("li"),a.length&&this.select(a))}},next:function(){if(this.visible){var b=this.selected?this.selected.next("li"):a("li:not(.unselectable):first",this.element);b.length&&this.select(b)}},ajax:function(a){var b=this,c=1===this.query.page?0:wpLinkPopup.minRiverAJAXDuration,d=wpLinkPopup.delayedCallback(function(c,d){b.process(c,d),a&&a(c,d)},c);this.query.ajax(d)},change:function(a){this.query&&this._search===a||(this._search=a,this.query=new c(a),this.element.scrollTop(0))},process:function(b,c){var d="",e=!0,f="",g=1===c.page;b?a.each(b,function(){f=e?"alternate":"",f+=this.title?"":" no-title",d+=f?'<li class="'+f+'">':"<li>",d+='<input type="hidden" class="item-permalink" value="'+this.permalink+'" />',d+='<span class="item-title">',d+=this.title?this.title:wpLinkL10nPopup.noTitle,d+='</span><span class="item-info">'+this.info+"</span></li>",e=!e}):g&&(d+='<li class="unselectable"><span class="item-title"><em>'+wpLinkL10nPopup.noMatchesFound+"</em></span></li>"),this.ul[g?"html":"append"](d)},maybeLoad:function(){var a=this,b=this.element,c=b.scrollTop()+b.height();!this.query.ready()||c<this.ul.height()-wpLinkPopup.riverBottomThreshold||setTimeout(function(){var c=b.scrollTop(),d=c+b.height();!a.query.ready()||d<a.ul.height()-wpLinkPopup.riverBottomThreshold||(a.waiting.show(),b.scrollTop(c+a.waiting.outerHeight()),a.ajax(function(){a.waiting.hide()}))},wpLinkPopup.timeToTriggerRiver)}}),c=function(a){this.page=1,this.allLoaded=!1,this.querying=!1,this.search=a},a.extend(c.prototype,{ready:function(){return!(this.querying||this.allLoaded)},ajax:function(b){var c=this,e={action:"wp-link-ajax",contentType:d.contentType.val(),page:this.page,_ajax_linking_nonce:d.nonce.val()};this.search&&(e.search=this.search),this.querying=!0,a.post(ajaxurl,e,function(a){c.page++,c.querying=!1,c.allLoaded=!a,b(a,e)},"json")}})}(jQuery),function(a){"user strict";a(document).ready(function(){wpLinkPopup.init(),a(".select-image").on("click.link-chooser",function(b){b.preventDefault(),wpLinkPopup.open(function(b){a("#linkurl").val(b.href),a("#linktarget").val(b.target),a("#linktitle").val(b.title)})}),a(".wpLinkPopup").each(function(){var b=a(this).data("linkvalue");a(this).on("click",function(){var c=a(this);wpLinkPopup.open(function(a){c.val(a[b])})})})})}(jQuery);